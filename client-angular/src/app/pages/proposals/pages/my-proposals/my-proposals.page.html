<div class="flex flex-col sm:flex-row sm:pt-40">

  <div class="w-1/3">
    <h1 class="font-bold text-transparent bg-clip-text bg-gradient-to-r
    from-pink-450 to-orange-450 max-w-fit inline-flex">
      <svg width="32" height="27" viewBox="0 0 32 27" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-2 mr-3">
        <path d="M31.834 27H7.83398L8.66877 25.7459L17.5731 12.8361V3.02459H15.2775V0H24.3905V3.02459H22.0949V12.8361L28.9122 22.7213L31.834 27Z" fill="url(#paint0_linear_3809_1476)"/>
        <path d="M24.3335 27H0.333496L1.16828 25.7459L10.0726 12.8361V3.02459H7.77697V0H16.89V3.02459H14.5944V12.8361L21.4118 22.7213L24.3335 27Z" fill="url(#paint1_linear_3809_1476)" fill-opacity="0.4"/>
        <defs>
          <linearGradient id="paint0_linear_3809_1476" x1="19.834" y1="0" x2="19.834" y2="27" gradientUnits="userSpaceOnUse">
            <stop stop-color="#FF9838"/>
            <stop offset="1" stop-color="#FF66DD"/>
          </linearGradient>
          <linearGradient id="paint1_linear_3809_1476" x1="12.3335" y1="0" x2="12.3335" y2="27" gradientUnits="userSpaceOnUse">
            <stop stop-color="#FF9838"/>
            <stop offset="1" stop-color="#FF66DD"/>
          </linearGradient>
        </defs>
      </svg>
      My Proposals
    </h1>
  </div>

  <div *ngIf="!currentUser.isActive" class="ml-10 justify-center flex flex-row align-middle items-center h-10">
    <p class="text-red mr-10">Your account is not active. You need to activate to vote</p>
    <button class="bg-green-100 font-bold h-9 px-10 text-green rounded-full" type="button" (click)="showActivateAccount()">
      Activate
    </button>
  </div>

  <div *ngIf="currentUser.isActive" class="sm:ml-auto sm:pr-10 mb-10 sm:mb-0">
    <button class="bg-green-100 font-bold h-9 px-10 text-green rounded-full" type="button" (click)="showNewProposal()">
      + New Proposal
    </button>
  </div>
</div>

<div class="flex-row sm:flex-col" *ngIf="pageSize && pageNum" >
  <div *ngIf="isLoading" class="flex items-center align-middle justify-center mt-5">
    <div class="w-40 h-40 border-t-4 border-b-4 border-pink-450 rounded-full animate-spin"></div>
  </div>

  <div *ngIf="!isLoading && !totalProposals" class="flex items-center align-middle justify-center mt-5">
    <h2 class="text-pink-300">No proposals yet</h2>
  </div>

  <div *ngFor="let proposal of proposals; let first = first; let last = last; let indexOfElement = index">
    <div [ngClass]="{'mt-10': !first, 'opacity-50': proposal.grant.toLowerCase() === 'notgranted'}"
         class="flex flex-col sm:flex-row h-auto sm:h-44 rounded-xl bg-blue-800 p-3">

      <div class="pt-5 pl-5 pr-8 min-w-[30px] w-[30px] items-end">#{{ pageSize * (pageNum - 1) + (indexOfElement + 1) }}</div>

      <div class="flex flex-col sm:w-1/3">
        <div>
          <h4 class="sm:hidden text-pink-450">Title</h4>
          <h4 class="inline mr-2">{{proposal.title}}</h4>

          <!-- START STATUS -->
          <span class="font-bold" *ngIf="proposal.votingStatus === 'not_started' && proposal.status !== 'rejected'">
            NOT STARTED
          </span>

          <span class="text-red-500 font-bold" *ngIf="proposal.status === 'rejected'">
            REJECTED
          </span>

          <span class="text-green-500 font-bold" *ngIf="proposal.votingStatus === 'active'">
            VOTE ACTIVE
          </span>

          <span [ngClass]="{'text-green-500': proposal.userVote === 'for', 'text-red-500': proposal.userVote === 'against'}"
                class="font-bold text-xs align-text-top" *ngIf="proposal.votingStatus === 'active' && proposal.votedByUser">
            *{{ proposal.userVote.toUpperCase() }}
          </span>

          <span *ngIf="proposal.votingStatus === 'ended' && proposal.grant === 'undecided'" class="text-green-500 font-bold" >
            VOTE ENDED
          </span>

          <span *ngIf="proposal.votingStatus === 'ended' && proposal.grant.toLowerCase() === 'granted'"
                class="text-green-500 font-bold sm:inline-block uppercase text-sm">
            GRANTED
          </span>

          <span *ngIf="proposal.votingStatus === 'ended' && proposal.grant.toLowerCase() === 'notgranted'"
                class="text-red-500 font-bold sm:inline-block uppercase text-sm">
            NOT GRANTED
          </span>
          <!-- END STATUS -->

          <div>{{proposal.description}}</div>
        </div>
        <div class="mt-auto">
          <span class="text-pink-450 font-bold">Proposer</span>
          <span class="block break-words">{{ proposal.creator }}</span>
        </div>
      </div>

      <div class="flex flex-col w-1/5">
        <div class="pt-4">
          <span class="text-pink-450 font-bold">Link</span>
          <span class="block">{{proposal.link}}</span>
        </div>

        <div class="mt-auto">
          <span class="text-pink-450 justify-end mt-auto font-bold">Created on</span>
          <span class="block">{{proposal.createdAt | dateAgo}}</span>
        </div>
      </div>

      <!-- START VOTING STATUS -->
      <div *ngIf="proposal.status === 'approved' && proposal.votingStatus === 'active'" class="flex flex-row ml-auto mr-10">
        <div class="align-middle m-auto justify-center">
          <span class="block text-pink-450 font-bold">Vote Result</span>
          <span class="block text-green-500">{{ proposal.votesFor }} Votes up</span>
          <span class="block text-red-500">{{ proposal.votesAgainst }} Votes down</span>
        </div>
      </div>

      <div *ngIf="proposal.status === 'approved' && proposal.votingStatus === 'not_started'" class="flex flex-row ml-auto mr-10">
        <span class="block font-bold text-pink-450">Vote starting on {{ proposal.votingPeriodStartDate | date:'MMM d' }} </span>
      </div>


      <div *ngIf="proposal.status === 'approved' && proposal.votingStatus === 'ended'" class="flex flex-row ml-auto mr-10">
        <span class="block font-bold text-pink-450">Vote ended on {{ proposal.votingPeriodEndDate | date:'MMM d' }} </span>
        <div class="align-middle m-auto justify-center">
          <span class="block text-pink-450 font-bold">Vote Result</span>
          <span class="block text-green-500">{{ proposal.votesFor }} Votes up</span>
          <span class="block text-red-500">{{ proposal.votesAgainst }} Votes down</span>
        </div>
      </div>
      <!-- END VOTING STATUS -->

    </div>
  </div>

  <div *ngIf="!isLoading && totalProposals" class="flex flex-row text-gray-400 py-10 sm:pl-24">
    <div *ngIf="totalProposals">
      Active proposals: {{totalActiveProposals}} / {{ totalProposals }}
    </div>
    <div class="ml-auto inline-flex">
      Row per page: 10
    </div>
    <div class="ml-24 w-36">
      <p *ngIf="pageSize && pageNum && totalProposals">
        {{ pageSize * (pageNum - 1) + 1 }} - {{pageSize * pageNum}} OF {{ totalProposals }}
      </p>
    </div>
    <div class="ml-16">
      <button type="button" [ngClass]="{'cursor-not-allowed': !canDoPreviousPage()}" [attr.disabled]="!canDoPreviousPage() ? 'disabled' : null" (click)="decrementCurrentPage()">
        <svg xmlns="http://www.w3.org/2000/svg" [ngClass]="{'opacity-50': !canDoPreviousPage()}" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <button type="button" [ngClass]="{'cursor-not-allowed': !canDoNextPage()}" [attr.disabled]="!canDoNextPage() ? 'disabled' : null" (click)="incrementCurrentPage()">
        <svg xmlns="http://www.w3.org/2000/svg" [ngClass]="{'opacity-50': !canDoNextPage()}" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"  />
        </svg>
      </button>
    </div>
  </div>

</div>
